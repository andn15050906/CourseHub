@page
@using CourseHub.Core.Helpers.Business;
@using CourseHub.UI.Helpers.Utils;
@model CourseHub.UI.Pages.Course.ManageModel
@{
}



<div class="container-fluid" style="margin-top: 40px;">

    <div>
        <a asp-page=""></a>
    </div>

    <div class="card shadow mb-4">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                    <thead>
                        <tr>
                            <th class="text-center">Title</th>
                            <th class="text-center">Image</th>
                            <th class="text-center">Status</th>
                            <th class="text-center">Price</th>
                            <th class="text-center">Discount</th>
                            <th class="text-center">Discount Expiry</th>
                            <th class="text-center">Level</th>
                            <th class="text-center">LearnerCount</th>
                            <th class="text-center">Average Rating</th>
                            <th class="text-center">Category</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.Courses.TotalCount == 0)
                        {
                            <tr>
                                <th style="text-align: center; color: red" colspan="10">Empty</th>
                            </tr>
                        }
                        else foreach (var course in Model.Courses.Items)
                        {
                            string avgRating = TextHelper.GetAverageRating(course.TotalRating, course.RatingCount);

                            <tr>
                                <td><a asp-page="@Global.PAGE_COURSE_UPDATE" asp-route-id="@course.Id">@course.Title</a></td>
                                <td style="width: 400px"><img src="@course.ThumbUrl" alt="thumb" style="aspect-ratio: 1.5" /></td>
                                <td>@course.Status.ToString()</td>
                                <td>@course.Price</td>
                                @if (CourseBusinessHelper.IsOnDiscount(course.Discount, course.DiscountExpiry))
                                {
                                    <td>@course.Discount %</td>
                                    <td>@course.DiscountExpiry.ToString("dd/MM/yyyy")</td>
                                }
                                else
                                {
                                    <td></td>
                                    <td></td>
                                }
                                <td>@course.Level.ToString()</td>
                                <td>@course.LearnerCount</td>
                                <td>@avgRating</td>
                                <td>@course.LeafCategoryId</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
